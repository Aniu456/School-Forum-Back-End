# 校园论坛 API 功能总览

> **Base URL**: `http://localhost:30000`
> **最后更新**: 2025-11-16

---

## 📚 文档索引

- **[ADMIN_API.md](ADMIN_API.md)** - 管理端完整 API 文档
- **[USER_API.md](USER_API.md)** - 用户端完整 API 文档

---

## 🔐 管理端功能 (ADMIN)

### 1. 认证
- ✅ 管理员注册 (需要 adminKey)
- ✅ 管理员登录
- ✅ 刷新 Token

### 2. 用户管理
- ✅ 获取用户列表 (支持角色筛选、封禁状态筛选)
- ✅ 封禁/解封用户
- ✅ 重置用户密码
- ✅ 修改用户角色 (STUDENT/TEACHER/ADMIN)
- ✅ 查看用户登录历史
- ✅ 禁止/允许用户发帖
- ✅ 禁止/允许用户评论

### 3. 举报管理
- ✅ 获取举报列表 (支持状态筛选、类型筛选)
- ✅ 处理举报 (通过/拒绝)

### 4. 内容管理
- ✅ 置顶/取消置顶帖子
- ✅ 加精华/取消精华
- ✅ 锁定/解锁帖子 (禁止评论)
- ✅ 隐藏/取消隐藏帖子
- ✅ 批量删除帖子
- ✅ 批量删除评论

### 5. 公告管理
- ✅ 创建公告
- ✅ 获取所有公告
- ✅ 更新公告
- ✅ 删除公告

### 6. 统计数据
- ✅ 获取系统统计 (用户、帖子、评论、举报统计)

---

## 👤 用户端功能 (USER)

### 1. 认证
- ✅ 用户注册
- ✅ 用户登录
- ✅ 刷新 Token
- ✅ 登出

### 2. 帖子管理
- ✅ 创建帖子
- ✅ 获取帖子列表 (支持排序、标签筛选、作者筛选)
- ✅ 获取帖子详情
- ✅ 更新帖子
- ✅ 删除帖子
- ✅ 获取帖子评论列表

### 3. 评论管理
- ✅ 创建评论 (支持一级评论和回复)
- ✅ 获取评论的回复列表
- ✅ 删除评论

### 4. 点赞功能
- ✅ 点赞/取消点赞 (帖子/评论)

### 5. 用户管理
- ✅ 获取当前用户资料
- ✅ 更新当前用户资料
- ✅ 获取用户详情
- ✅ 获取用户发帖列表
- ✅ 获取用户点赞列表

### 6. 关注功能
- ✅ 关注用户
- ✅ 取消关注
- ✅ 获取关注列表
- ✅ 获取粉丝列表

### 7. 收藏功能
- ✅ 创建收藏夹
- ✅ 获取收藏夹列表
- ✅ 获取收藏夹详情
- ✅ 更新收藏夹
- ✅ 删除收藏夹
- ✅ 收藏帖子
- ✅ 取消收藏
- ✅ 获取收藏夹中的帖子

### 8. 通知功能
- ✅ 获取通知列表 (支持已读状态筛选、类型筛选)
- ✅ 获取未读通知数量
- ✅ 标记单个通知为已读
- ✅ 标记所有通知为已读
- ✅ 删除通知

### 9. 搜索功能
- ✅ 搜索帖子 (支持关键词、排序、标签筛选)
- ✅ 搜索用户
- ✅ 获取热门标签

### 10. 公告功能
- ✅ 获取公告列表
- ✅ 获取公告详情

### 11. 举报功能
- ✅ 创建举报 (帖子/评论/用户)

### 12. 草稿功能
- ✅ 创建或更新草稿 (自动保存)
- ✅ 获取草稿列表
- ✅ 获取草稿详情
- ✅ 更新草稿
- ✅ 删除草稿
- ✅ 从草稿发布帖子

### 13. 推荐功能
- ✅ 获取热门帖子
- ✅ 获取趋势帖子 (新晋热门)
- ✅ 获取最新帖子
- ✅ 获取个性化推荐 (基于关注)
- ✅ 获取热门话题
- ✅ 获取所有话题

---

## 📊 接口统计

| 模块 | 管理端接口数 | 用户端接口数 |
|-----|------------|------------|
| 认证 | 3 | 4 |
| 用户管理 | 8 | 5 |
| 帖子管理 | 10 | 6 |
| 评论管理 | 1 | 3 |
| 点赞 | - | 1 |
| 关注 | - | 4 |
| 收藏 | - | 8 |
| 通知 | - | 5 |
| 搜索 | - | 3 |
| 举报 | 2 | 1 |
| 公告 | 4 | 2 |
| 草稿 | - | 6 |
| 推荐 | - | 6 |
| 统计 | 1 | - |
| **总计** | **29** | **54** |

---

## 🔑 认证说明

### 管理端
- 所有接口都需要 JWT Bearer Token
- 用户 `role` 必须为 `ADMIN`
- 管理员注册需要 `ADMIN_REGISTRATION_KEY`

### 用户端
- 标记为 🔓 的接口无需登录
- 其他接口需要 JWT Bearer Token
- Token 过期时使用 `refreshToken` 刷新

---

## 📝 快速开始

### 1. 管理员注册
```bash
POST /auth/register-admin
{
  "username": "admin",
  "email": "admin@example.com",
  "password": "password123",
  "adminKey": "your-admin-key"
}
```

### 2. 用户注册
```bash
POST /auth/register
{
  "username": "student01",
  "email": "student@example.com",
  "password": "password123",
  "studentId": "2024001"
}
```

### 3. 登录
```bash
POST /auth/login
{
  "email": "admin@example.com",
  "password": "password123"
}
```

### 4. 使用 Token
```bash
curl -H "Authorization: Bearer <your_token>" \
  http://localhost:30000/posts
```

---

## ⚠️ 重要提示

1. **环境变量配置**
   - `JWT_SECRET` - JWT 密钥 (必需)
   - `JWT_REFRESH_SECRET` - Refresh Token 密钥 (必需)
   - `SESSION_SECRET` - Session 密钥 (必需)
   - `ADMIN_REGISTRATION_KEY` - 管理员注册密钥 (必需)

2. **生成强密钥**
   ```bash
   openssl rand -base64 32
   ```

3. **CORS 配置**
   ```bash
   CORS_ORIGIN=http://localhost:3000,http://localhost:3001
   ```

---

## 🐛 常见错误码

| 状态码 | 说明 | 解决方法 |
|-------|------|---------|
| 400 | 请求参数错误 | 检查请求体格式和必需字段 |
| 401 | 未登录或 Token 失效 | 重新登录或刷新 Token |
| 403 | 权限不足 | 确认用户角色是否正确 |
| 404 | 资源不存在 | 确认 ID 是否正确 |
| 409 | 资源冲突 | 如用户名已存在 |
| 500 | 服务器错误 | 查看后端日志 |

---

**维护者**: 后端开发团队
**版本**: v1.0.0
